openapi: 3.1.0
info:
  title: UJUz (ìš°ì¥¬) - ì–´ë¦°ì´ì§‘ ì…ì†Œ ë„ìš°ë¯¸ API
  description: |
    UJUzëŠ” ëŒ€í•œë¯¼êµ­ ì–´ë¦°ì´ì§‘ ì…ì†Œë¥¼ ë•ëŠ” AI ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.
    ì£¼ë³€ ì–´ë¦°ì´ì§‘ ê²€ìƒ‰, ì…ì†Œ ì ìˆ˜ ì˜ˆì¸¡, TO(ì¶©ì›) ì•Œë¦¼, AI ìƒë‹´ ë“±ì„ ì œê³µí•©ë‹ˆë‹¤.

    ì£¼ìš” ê¸°ëŠ¥:
    - ğŸ“ ìœ„ì¹˜ ê¸°ë°˜ ì–´ë¦°ì´ì§‘ ê²€ìƒ‰ (ë°˜ê²½, ì¹´í…Œê³ ë¦¬ í•„í„°)
    - ğŸ”¢ ì…ì†Œ ì ìˆ˜ ê³„ì‚° ë° ì˜ˆì¸¡
    - ğŸ”” TO(ì¶©ì›) ì•Œë¦¼ êµ¬ë…
    - ğŸ¤– AI ìƒë‹´ (ìš°ì£¼ë´‡)
    - ğŸ‘¶ ìë…€ ì •ë³´ ê´€ë¦¬
  version: 1.6.0
  contact:
    name: UJUz Team
    url: https://ujuz.kr

servers:
  - url: https://api.ujuz.kr
    description: Production
  - url: http://localhost:3000
    description: Development

paths:
  /places/nearby:
    get:
      operationId: getNearbyPlaces
      summary: ì£¼ë³€ ì–´ë¦°ì´ì§‘/ì‹œì„¤ ê²€ìƒ‰
      description: |
        ì‚¬ìš©ì ìœ„ì¹˜ ê¸°ì¤€ìœ¼ë¡œ ì£¼ë³€ ì–´ë¦°ì´ì§‘ ë° ì•„ë™ ì‹œì„¤ì„ ê²€ìƒ‰í•©ë‹ˆë‹¤.
        GeoJSON 2dsphere ì¸ë±ìŠ¤ ê¸°ë°˜ ê±°ë¦¬ ê³„ì‚°ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
      parameters:
        - name: lat
          in: query
          required: true
          description: "ì‚¬ìš©ì ìœ„ë„ (ì˜ˆ: 37.4979)"
          schema:
            type: number
            minimum: -90
            maximum: 90
            example: 37.4979
        - name: lng
          in: query
          required: true
          description: "ì‚¬ìš©ì ê²½ë„ (ì˜ˆ: 127.0276)"
          schema:
            type: number
            minimum: -180
            maximum: 180
            example: 127.0276
        - name: radius
          in: query
          description: ê²€ìƒ‰ ë°˜ê²½ (ë¯¸í„°, ê¸°ë³¸ 5000)
          schema:
            type: integer
            minimum: 100
            maximum: 50000
            default: 5000
        - name: categories
          in: query
          description: ì¹´í…Œê³ ë¦¬ í•„í„° (ì‰¼í‘œ êµ¬ë¶„, ì˜ˆ daycare,playground)
          schema:
            type: string
            example: daycare
        - name: limit
          in: query
          description: ê²°ê³¼ ìˆ˜ (ê¸°ë³¸ 20, ìµœëŒ€ 50)
          schema:
            type: integer
            minimum: 1
            maximum: 50
            default: 20
        - name: offset
          in: query
          description: í˜ì´ì§€ ì˜¤í”„ì…‹
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: ì£¼ë³€ ì‹œì„¤ ëª©ë¡
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/PlaceWithDistance'

  /places/search:
    get:
      operationId: searchPlaces
      summary: ì–´ë¦°ì´ì§‘/ì‹œì„¤ í…ìŠ¤íŠ¸ ê²€ìƒ‰
      description: ì–´ë¦°ì´ì§‘ ì´ë¦„ ë˜ëŠ” ì£¼ì†Œë¡œ ê²€ìƒ‰í•©ë‹ˆë‹¤.
      parameters:
        - name: q
          in: query
          required: true
          description: ê²€ìƒ‰ì–´ (1~50ì)
          schema:
            type: string
            minLength: 1
            maxLength: 50
            example: í–‡ì‚´ ì–´ë¦°ì´ì§‘
        - name: limit
          in: query
          description: ê²°ê³¼ ìˆ˜ (ê¸°ë³¸ 10, ìµœëŒ€ 50)
          schema:
            type: integer
            minimum: 1
            maximum: 50
            default: 10
      responses:
        '200':
          description: ê²€ìƒ‰ ê²°ê³¼
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/PlaceSummary'

  /places/{id}:
    get:
      operationId: getPlaceById
      summary: ì‹œì„¤ ìƒì„¸ ì •ë³´
      description: íŠ¹ì • ì–´ë¦°ì´ì§‘/ì‹œì„¤ì˜ ìƒì„¸ ì •ë³´ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: ì‹œì„¤ ìƒì„¸
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/PlaceDetail'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/ujuz/admission/calculate:
    post:
      operationId: calculateAdmissionScore
      summary: ì…ì†Œ ì ìˆ˜ ê³„ì‚°
      description: |
        ì–´ë¦°ì´ì§‘ ì…ì†Œ ì ìˆ˜ë¥¼ ê³„ì‚°í•˜ê³  ì…ì†Œ ê°€ëŠ¥ì„±ì„ ì˜ˆì¸¡í•©ë‹ˆë‹¤.
        ë§ë²Œì´, í•œë¶€ëª¨, ë‹¤ìë…€ ë“± ìš°ì„ ìˆœìœ„ ì ìˆ˜ë¥¼ ë°˜ì˜í•©ë‹ˆë‹¤.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - facility_id
                - child_id
                - target_class
                - priority_type
              properties:
                facility_id:
                  type: string
                  description: ì–´ë¦°ì´ì§‘ ID
                child_id:
                  type: string
                  description: ìë…€ ID
                target_class:
                  type: string
                  description: ì…ì†Œ í¬ë§ ë°˜ (ì˜ˆ 0ì„¸ë°˜, 1ì„¸ë°˜)
                  enum: [0ì„¸ë°˜, 1ì„¸ë°˜, 2ì„¸ë°˜, 3ì„¸ë°˜, 4ì„¸ë°˜, 5ì„¸ë°˜]
                priority_type:
                  type: string
                  description: ìš°ì„ ìˆœìœ„ ìœ í˜•
                  enum: [dual_income, single_parent, multi_child, disability, low_income, none]
                additional_priorities:
                  type: array
                  items:
                    type: string
                waiting_position:
                  type: integer
      responses:
        '200':
          description: ì ìˆ˜ ê³„ì‚° ê²°ê³¼
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/AdmissionResult'

  /api/ujuz/admission/history:
    get:
      operationId: getAdmissionHistory
      summary: ì…ì†Œ ì ìˆ˜ ì¡°íšŒ ì´ë ¥
      description: ì‚¬ìš©ìì˜ ì…ì†Œ ì ìˆ˜ ê³„ì‚° ì´ë ¥ì„ ë°˜í™˜í•©ë‹ˆë‹¤.
      responses:
        '200':
          description: ì ìˆ˜ ì´ë ¥
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/AdmissionResult'

  /api/ujuz/alerts/to:
    get:
      operationId: getTOSubscriptions
      summary: TO ì•Œë¦¼ êµ¬ë… ëª©ë¡
      description: ì‚¬ìš©ìê°€ êµ¬ë… ì¤‘ì¸ ì–´ë¦°ì´ì§‘ TO(ì¶©ì›) ì•Œë¦¼ ëª©ë¡ì„ ë°˜í™˜í•©ë‹ˆë‹¤.
      responses:
        '200':
          description: êµ¬ë… ëª©ë¡
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/TOSubscription'
    post:
      operationId: subscribeTOAlert
      summary: TO ì•Œë¦¼ êµ¬ë…
      description: íŠ¹ì • ì–´ë¦°ì´ì§‘ì˜ TO(ì¶©ì›) ì•Œë¦¼ì„ êµ¬ë…í•©ë‹ˆë‹¤.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - facility_id
                - facility_name
              properties:
                facility_id:
                  type: string
                facility_name:
                  type: string
                target_classes:
                  type: array
                  items:
                    type: string
                notification_preferences:
                  type: object
                  properties:
                    push:
                      type: boolean
                    email:
                      type: boolean
      responses:
        '200':
          description: êµ¬ë… ì„±ê³µ
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/TOSubscription'

  /api/ujuz/alerts/to/history:
    get:
      operationId: getTOAlertHistory
      summary: TO ì•Œë¦¼ ì´ë ¥
      description: ìµœê·¼ ì–´ë¦°ì´ì§‘ TO(ì¶©ì›) ì•Œë¦¼ ì´ë ¥ì„ ë°˜í™˜í•©ë‹ˆë‹¤.
      responses:
        '200':
          description: ì•Œë¦¼ ì´ë ¥
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/TOAlert'

  /api/ujuz/bot/query:
    post:
      operationId: queryBot
      summary: ìš°ì£¼ë´‡ AI ìƒë‹´
      description: |
        ì–´ë¦°ì´ì§‘ ì…ì†Œ, ë³´ìœ¡ ê´€ë ¨ ì§ˆë¬¸ì— AIê°€ ë‹µë³€í•©ë‹ˆë‹¤.
        ëŒ€í™” ì»¨í…ìŠ¤íŠ¸ë¥¼ ìœ ì§€í•˜ì—¬ ì—°ì† ëŒ€í™”ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - message
              properties:
                message:
                  type: string
                  description: ì‚¬ìš©ì ì§ˆë¬¸
                  example: ê°•ë‚¨êµ¬ì—ì„œ ë§ë²Œì´ ê°€ì •ì´ êµ­ê³µë¦½ ì–´ë¦°ì´ì§‘ ì…ì†Œí•˜ë ¤ë©´ ì ìˆ˜ê°€ ì–¼ë§ˆë‚˜ í•„ìš”í•œê°€ìš”?
                conversation_id:
                  type: string
                  description: ëŒ€í™” ID (ì—°ì† ëŒ€í™” ì‹œ)
                context:
                  type: object
                  description: ì¶”ê°€ ì»¨í…ìŠ¤íŠ¸
      responses:
        '200':
          description: AI ì‘ë‹µ
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    type: object
                    properties:
                      answer:
                        type: string
                      conversation_id:
                        type: string
                      sources:
                        type: array
                        items:
                          type: string

  /api/ujuz/v1/admission-score:
    get:
      operationId: getAdmissionScoreV1
      summary: ì…ì†Œ ì ìˆ˜ ê³„ì‚° (V1 Engine)
      description: |
        Gamma-Poisson ë² ì´ì§€ì•ˆ ì—”ì§„ìœ¼ë¡œ 6ê°œì›” ë‚´ ì…ì†Œ í™•ë¥ ì„ ê³„ì‚°í•©ë‹ˆë‹¤.
        ì§€ì—­ë³„ ì‚¬ì „ë¶„í¬, ì‹œì¦Œì„±, ìš°ì„ ìˆœìœ„ ë³´ì •ì´ ì ìš©ë©ë‹ˆë‹¤.
      parameters:
        - name: facility_id
          in: query
          required: true
          description: ì‹œì„¤ ID (placeId ë˜ëŠ” UUID)
          schema:
            type: string
        - name: child_age_band
          in: query
          required: true
          description: ìë…€ ì—°ë ¹ëŒ€ (0-5)
          schema:
            type: string
            enum: ['0', '1', '2', '3', '4', '5']
        - name: priority_type
          in: query
          required: true
          description: ìš°ì„ ìˆœìœ„ ìœ í˜•
          schema:
            type: string
            enum: [dual_income, sibling, single_parent, multi_child, disability, low_income, general]
        - name: waiting_position
          in: query
          description: ëŒ€ê¸° ìˆœë²ˆ (ë¯¸ì œê³µ ì‹œ ê¸°ë³¸ê°’ ì‚¬ìš©)
          schema:
            type: integer
            minimum: 0
      responses:
        '200':
          description: ì…ì†Œ ì ìˆ˜ ê²°ê³¼
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/AdmissionScoreV1'

  /api/ujuz/v1/admission-score/bot-format:
    get:
      operationId: getAdmissionScoreBotFormat
      summary: ì…ì†Œ ì ìˆ˜ ë´‡ í¬ë§·
      description: ì…ì†Œ ì ìˆ˜ë¥¼ ìì—°ì–´ í…ìŠ¤íŠ¸ë¡œ ë°˜í™˜í•©ë‹ˆë‹¤.
      parameters:
        - name: facility_id
          in: query
          required: true
          schema:
            type: string
        - name: child_age_band
          in: query
          required: true
          schema:
            type: string
            enum: ['0', '1', '2', '3', '4', '5']
        - name: priority_type
          in: query
          required: true
          schema:
            type: string
            enum: [dual_income, sibling, single_parent, multi_child, disability, low_income, general]
      responses:
        '200':
          description: ë´‡ í¬ë§· ì‘ë‹µ
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    type: object
                    properties:
                      message:
                        type: string
                        description: ìì—°ì–´ ì…ì†Œ ë¶„ì„ í…ìŠ¤íŠ¸

  /insights:
    get:
      operationId: getInsights
      summary: ì‹œì„¤ ì¸ì‚¬ì´íŠ¸ ì¡°íšŒ
      description: í•˜ë‚˜ ì´ìƒì˜ ì‹œì„¤ì— ëŒ€í•œ AI ë¶„ì„ ì¸ì‚¬ì´íŠ¸ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
      parameters:
        - name: placeIds
          in: query
          required: true
          description: ì‹œì„¤ ID (ì‰¼í‘œ êµ¬ë¶„ ë˜ëŠ” ë°°ì—´)
          schema:
            oneOf:
              - type: string
              - type: array
                items:
                  type: string
      responses:
        '200':
          description: ì¸ì‚¬ì´íŠ¸ ëª©ë¡
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Insight'

  /peer/live-status:
    get:
      operationId: getPeerLiveStatus
      summary: í”¼ì–´ ì‹¤ì‹œê°„ í˜„í™©
      description: ì»¤ë®¤ë‹ˆí‹° ì‹¤ì‹œê°„ í™œë™ í˜„í™©ì„ ë°˜í™˜í•©ë‹ˆë‹¤.
      responses:
        '200':
          description: ì‹¤ì‹œê°„ í˜„í™©
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    type: object

  /peer/activities:
    get:
      operationId: getPeerActivities
      summary: í”¼ì–´ í™œë™ ëª©ë¡
      description: ìµœê·¼ ì»¤ë®¤ë‹ˆí‹° í™œë™ ëª©ë¡ì„ í˜ì´ì§€ë„¤ì´ì…˜ìœ¼ë¡œ ë°˜í™˜í•©ë‹ˆë‹¤.
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: í™œë™ ëª©ë¡
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    type: object

  /peer/trending/places:
    get:
      operationId: getPeerTrendingPlaces
      summary: ì¸ê¸° ì‹œì„¤ ëª©ë¡
      description: ì»¤ë®¤ë‹ˆí‹°ì—ì„œ ê°€ì¥ ë§ì´ ì–¸ê¸‰ë˜ëŠ” ì‹œì„¤ ëª©ë¡ì„ ë°˜í™˜í•©ë‹ˆë‹¤.
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 30
            default: 10
      responses:
        '200':
          description: ì¸ê¸° ì‹œì„¤
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    type: array
                    items:
                      type: object

  /peer/activity:
    post:
      operationId: recordPeerActivity
      summary: í”¼ì–´ í™œë™ ê¸°ë¡
      description: ì‹œì„¤ ë°©ë¬¸, ë¦¬ë·° ë“±ì˜ í™œë™ì„ ê¸°ë¡í•©ë‹ˆë‹¤.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - activity_type
              properties:
                activity_type:
                  type: string
                  enum: [visit, review, question, info_share, recommendation]
                place_id:
                  type: string
                place_name:
                  type: string
                  maxLength: 200
                age_group:
                  type: string
                description:
                  type: string
                  maxLength: 2000
      responses:
        '201':
          description: í™œë™ ê¸°ë¡ ì„±ê³µ
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    type: object

  /group-buys:
    get:
      operationId: listGroupBuys
      summary: ê³µë™êµ¬ë§¤ ëª©ë¡
      description: ê³µë™êµ¬ë§¤ ëª©ë¡ì„ í•„í„°/ì •ë ¬/í˜ì´ì§€ë„¤ì´ì…˜ìœ¼ë¡œ ì¡°íšŒí•©ë‹ˆë‹¤.
      parameters:
        - name: item_type
          in: query
          schema:
            type: string
        - name: status
          in: query
          schema:
            type: string
        - name: sort_by
          in: query
          schema:
            type: string
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: ê³µë™êµ¬ë§¤ ëª©ë¡
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    type: object

  /group-buys/joined:
    get:
      operationId: getJoinedGroupBuys
      summary: ì°¸ì—¬ ì¤‘ì¸ ê³µë™êµ¬ë§¤
      description: ì‚¬ìš©ìê°€ ì°¸ì—¬ ì¤‘ì¸ ê³µë™êµ¬ë§¤ ëª©ë¡ì„ ë°˜í™˜í•©ë‹ˆë‹¤.
      responses:
        '200':
          description: ì°¸ì—¬ ëª©ë¡
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    type: array
                    items:
                      type: object

  /group-buys/{id}:
    get:
      operationId: getGroupBuyById
      summary: ê³µë™êµ¬ë§¤ ìƒì„¸
      description: íŠ¹ì • ê³µë™êµ¬ë§¤ì˜ ìƒì„¸ ì •ë³´ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: ê³µë™êµ¬ë§¤ ìƒì„¸
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    type: object
        '404':
          $ref: '#/components/responses/NotFound'

  /group-buys/{id}/join:
    post:
      operationId: joinGroupBuy
      summary: ê³µë™êµ¬ë§¤ ì°¸ì—¬
      description: íŠ¹ì • ê³µë™êµ¬ë§¤ì— ì°¸ì—¬í•©ë‹ˆë‹¤.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: ì°¸ì—¬ ì„±ê³µ
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    type: object

  /group-buys/{id}/leave:
    delete:
      operationId: leaveGroupBuy
      summary: ê³µë™êµ¬ë§¤ íƒˆí‡´
      description: íŠ¹ì • ê³µë™êµ¬ë§¤ì—ì„œ íƒˆí‡´í•©ë‹ˆë‹¤.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: íƒˆí‡´ ì„±ê³µ
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean

  /api/ujuz/users/me:
    get:
      operationId: getUserProfile
      summary: ì‚¬ìš©ì í”„ë¡œí•„ ì¡°íšŒ
      description: í˜„ì¬ ì‚¬ìš©ìì˜ í”„ë¡œí•„ê³¼ ìë…€ ì •ë³´ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
      responses:
        '200':
          description: í”„ë¡œí•„ ì •ë³´
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/UserProfile'
    patch:
      operationId: updateUserProfile
      summary: ì‚¬ìš©ì í”„ë¡œí•„ ìˆ˜ì •
      description: ì‚¬ìš©ìì˜ í‘œì‹œ ì´ë¦„, ì•„ë°”íƒ€ ë“±ì„ ìˆ˜ì •í•©ë‹ˆë‹¤.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                display_name:
                  type: string
                  maxLength: 50
                avatar_url:
                  type: string
                  format: uri
                  maxLength: 500
      responses:
        '200':
          description: ìˆ˜ì • ì„±ê³µ
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean

  /api/ujuz/users/me/children:
    post:
      operationId: addChild
      summary: ìë…€ ë“±ë¡
      description: ì‚¬ìš©ìì˜ ìë…€ ì •ë³´ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - nickname
                - birth_date
              properties:
                nickname:
                  type: string
                  minLength: 1
                  maxLength: 50
                birth_date:
                  type: string
                  pattern: '^\d{4}-\d{2}-\d{2}$'
                  description: ISO date format (YYYY-MM-DD)
                age_class:
                  type: string
                  nullable: true
                target_facilities:
                  type: array
                  items:
                    type: string
                priority_types:
                  type: array
                  items:
                    type: string
      responses:
        '201':
          description: ìë…€ ë“±ë¡ ì„±ê³µ
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    type: object
                    properties:
                      id:
                        type: string
                      nickname:
                        type: string
                      birth_date:
                        type: string
                      age_class:
                        type: string
                        nullable: true

  /api/ujuz/users/me/push-token:
    post:
      operationId: registerPushToken
      summary: í‘¸ì‹œ í† í° ë“±ë¡
      description: í‘¸ì‹œ ì•Œë¦¼ì„ ìœ„í•œ ë””ë°”ì´ìŠ¤ í† í°ì„ ë“±ë¡í•©ë‹ˆë‹¤.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - token
              properties:
                token:
                  type: string
      responses:
        '200':
          description: ë“±ë¡ ì„±ê³µ
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean

  /api/ujuz/alerts/to/{facilityId}:
    delete:
      operationId: unsubscribeTOAlert
      summary: TO ì•Œë¦¼ êµ¬ë… í•´ì œ
      description: íŠ¹ì • ì–´ë¦°ì´ì§‘ì˜ TO ì•Œë¦¼ êµ¬ë…ì„ í•´ì œí•©ë‹ˆë‹¤.
      parameters:
        - name: facilityId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: í•´ì œ ì„±ê³µ
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean

  /api/ujuz/bot/conversations:
    get:
      operationId: listBotConversations
      summary: ëŒ€í™” ëª©ë¡
      description: ì‚¬ìš©ìì˜ ìš°ì£¼ë´‡ ëŒ€í™” ëª©ë¡ì„ ë°˜í™˜í•©ë‹ˆë‹¤.
      responses:
        '200':
          description: ëŒ€í™” ëª©ë¡
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    type: object
                    properties:
                      conversations:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: string
                            title:
                              type: string
                            last_message:
                              type: string
                            created_at:
                              type: string
                              format: date-time
                            updated_at:
                              type: string
                              format: date-time

  /api/ujuz/bot/conversations/{id}:
    get:
      operationId: getBotConversation
      summary: ëŒ€í™” ìƒì„¸
      description: íŠ¹ì • ëŒ€í™”ì˜ ì „ì²´ ë©”ì‹œì§€ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: ëŒ€í™” ìƒì„¸
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    type: object
        '404':
          $ref: '#/components/responses/NotFound'
    delete:
      operationId: deleteBotConversation
      summary: ëŒ€í™” ì‚­ì œ
      description: íŠ¹ì • ëŒ€í™”ë¥¼ ì‚­ì œí•©ë‹ˆë‹¤.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: ì‚­ì œ ì„±ê³µ
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean

  /api/ujuz/subscriptions/plans:
    get:
      operationId: getSubscriptionPlans
      summary: êµ¬ë… ìš”ê¸ˆì œ ëª©ë¡
      description: ì´ìš© ê°€ëŠ¥í•œ êµ¬ë… ìš”ê¸ˆì œë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
      responses:
        '200':
          description: ìš”ê¸ˆì œ ëª©ë¡
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    type: array
                    items:
                      type: object

  /api/ujuz/subscriptions/me:
    get:
      operationId: getUserSubscription
      summary: ë‚´ êµ¬ë… ì¡°íšŒ
      description: í˜„ì¬ ì‚¬ìš©ìì˜ êµ¬ë… ì •ë³´ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
      responses:
        '200':
          description: êµ¬ë… ì •ë³´
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    type: object
                    properties:
                      subscription:
                        type: object
                        nullable: true

  /api/ujuz/subscriptions/subscribe:
    post:
      operationId: createSubscription
      summary: êµ¬ë… ìƒì„±
      description: ìƒˆë¡œìš´ êµ¬ë…ì„ ìƒì„±í•©ë‹ˆë‹¤. ë ˆí¼ëŸ´ ì½”ë“œ í¬í•¨ ì‹œ ì¶”ì²œ ì¶”ì ë©ë‹ˆë‹¤.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - plan_tier
              properties:
                plan_tier:
                  type: string
                  enum: [free, basic, premium]
                billing_cycle:
                  type: string
                  enum: [monthly, yearly]
                  default: monthly
                referral_code:
                  type: string
                  minLength: 4
                  description: ì¶”ì²œ ì½”ë“œ (ì„ íƒ)
                device_id:
                  type: string
                  description: ë””ë°”ì´ìŠ¤ ID (ì„ íƒ)
      responses:
        '200':
          description: êµ¬ë… ìƒì„± ì„±ê³µ
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    type: object
                    properties:
                      subscription:
                        type: object

  /api/ujuz/subscriptions/cancel:
    post:
      operationId: cancelSubscription
      summary: êµ¬ë… í•´ì§€
      description: í˜„ì¬ êµ¬ë…ì„ í•´ì§€í•©ë‹ˆë‹¤.
      responses:
        '200':
          description: í•´ì§€ ì„±ê³µ
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean

  # â”€â”€ Partner Admin Routes (x-admin-key) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  /api/ujuz/partners/orgs:
    post:
      operationId: createPartnerOrg
      summary: íŒŒíŠ¸ë„ˆ ì¡°ì§ ìƒì„±
      description: ìƒˆë¡œìš´ íŒŒíŠ¸ë„ˆ ì¡°ì§ì„ ë“±ë¡í•©ë‹ˆë‹¤. (ê´€ë¦¬ì ì „ìš©)
      security:
        - adminKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
                  minLength: 2
                org_type:
                  type: string
                  default: other
                contact_name:
                  type: string
                contact_email:
                  type: string
                  format: email
      responses:
        '200':
          description: ì¡°ì§ ìƒì„± ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OkDataResponse'

  /api/ujuz/partners/cafes:
    post:
      operationId: createPartnerCafe
      summary: íŒŒíŠ¸ë„ˆ ì¹´í˜ ìƒì„±
      description: íŒŒíŠ¸ë„ˆ ì¡°ì§ í•˜ìœ„ì— ì¹´í˜(ì±„ë„)ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. (ê´€ë¦¬ì ì „ìš©)
      security:
        - adminKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - org_id
                - name
              properties:
                org_id:
                  type: string
                  minLength: 3
                platform:
                  type: string
                  default: etc
                platform_cafe_id:
                  type: string
                name:
                  type: string
                  minLength: 2
                url:
                  type: string
                  format: uri
                region:
                  type: string
                share_rate_subscription:
                  type: number
                  minimum: 0
                  maximum: 1
                share_rate_commerce:
                  type: number
                  minimum: 0
                  maximum: 1
      responses:
        '200':
          description: ì¹´í˜ ìƒì„± ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OkDataResponse'

  /api/ujuz/partners/orgs/{orgId}/api-keys:
    post:
      operationId: issuePartnerApiKey
      summary: íŒŒíŠ¸ë„ˆ API í‚¤ ë°œê¸‰
      description: íŒŒíŠ¸ë„ˆ ì¡°ì§ì˜ API í‚¤ë¥¼ ë°œê¸‰í•©ë‹ˆë‹¤. rawKeyëŠ” í•œ ë²ˆë§Œ í‘œì‹œë©ë‹ˆë‹¤. (ê´€ë¦¬ì ì „ìš©)
      security:
        - adminKeyAuth: []
      parameters:
        - name: orgId
          in: path
          required: true
          schema:
            type: string
            minLength: 3
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
      responses:
        '200':
          description: API í‚¤ ë°œê¸‰ ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OkDataResponse'

  /api/ujuz/partners/cafes/{cafeId}/referral-links:
    post:
      operationId: createReferralLink
      summary: ì¶”ì²œ ë§í¬ ìƒì„±
      description: ì¹´í˜ì˜ ì¶”ì²œ ë§í¬ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. (ê´€ë¦¬ì ì „ìš©)
      security:
        - adminKeyAuth: []
      parameters:
        - name: cafeId
          in: path
          required: true
          schema:
            type: string
            minLength: 3
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                channel:
                  type: string
                landing_path:
                  type: string
      responses:
        '200':
          description: ë§í¬ ìƒì„± ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OkDataResponse'

  /api/ujuz/partners/cafes/{cafeId}/widgets:
    post:
      operationId: createWidget
      summary: ìœ„ì ¯ ìƒì„±
      description: ì¹´í˜ì— ì„ë² ë“œ ìœ„ì ¯ì„ ìƒì„±í•©ë‹ˆë‹¤. (ê´€ë¦¬ì ì „ìš©)
      security:
        - adminKeyAuth: []
      parameters:
        - name: cafeId
          in: path
          required: true
          schema:
            type: string
            minLength: 3
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                type:
                  type: string
                config:
                  type: object
      responses:
        '200':
          description: ìœ„ì ¯ ìƒì„± ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OkDataResponse'

  /api/ujuz/partners/payouts/preview:
    get:
      operationId: previewPayout
      summary: ì •ì‚° ë¯¸ë¦¬ë³´ê¸°
      description: ì§€ì • ì›”ì˜ ì •ì‚° ë‚´ì—­ì„ ë¯¸ë¦¬ë³´ê¸°í•©ë‹ˆë‹¤. (ê´€ë¦¬ì ì „ìš©)
      security:
        - adminKeyAuth: []
      parameters:
        - name: period
          in: query
          required: true
          description: "ì •ì‚° ê¸°ê°„ (YYYY-MM)"
          schema:
            type: string
            pattern: '^\d{4}-\d{2}$'
            example: '2026-01'
      responses:
        '200':
          description: ì •ì‚° ë¯¸ë¦¬ë³´ê¸°
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OkDataResponse'

  /api/ujuz/partners/payouts/run:
    post:
      operationId: runPayout
      summary: ì •ì‚° ì‹¤í–‰
      description: ì§€ì • ì›”ì˜ ì •ì‚°ì„ ì‹¤í–‰í•©ë‹ˆë‹¤. (ê´€ë¦¬ì ì „ìš©)
      security:
        - adminKeyAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - period
              properties:
                period:
                  type: string
                  pattern: '^\d{4}-\d{2}$'
      responses:
        '200':
          description: ì •ì‚° ì‹¤í–‰ ì™„ë£Œ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OkDataResponse'

  # â”€â”€ Partner Self-Service Routes (x-partner-key) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  /api/ujuz/partners/me/cafes:
    get:
      operationId: getPartnerCafes
      summary: ë‚´ ì¹´í˜ ëª©ë¡
      description: íŒŒíŠ¸ë„ˆ ì¡°ì§ì˜ ì¹´í˜ ëª©ë¡ì„ ë°˜í™˜í•©ë‹ˆë‹¤. (íŒŒíŠ¸ë„ˆ ì¸ì¦ í•„ìš”)
      security:
        - partnerKeyAuth: []
      responses:
        '200':
          description: ì¹´í˜ ëª©ë¡
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        cafe_id:
                          type: string
                        name:
                          type: string
                        platform:
                          type: string
                        url:
                          type: string
                        status:
                          type: string
                        share_rate_subscription:
                          type: number
                        share_rate_commerce:
                          type: number

  /api/ujuz/partners/cafes/{cafeId}/external-posts/batch:
    post:
      operationId: batchExternalPosts
      summary: ì™¸ë¶€ ê¸€ ì¼ê´„ ë“±ë¡
      description: ì¹´í˜ì— ì™¸ë¶€ ê²Œì‹œë¬¼ì„ ì¼ê´„ ë“±ë¡í•©ë‹ˆë‹¤ (ìµœëŒ€ 200ê±´). (íŒŒíŠ¸ë„ˆ ì¸ì¦ í•„ìš”)
      security:
        - partnerKeyAuth: []
      parameters:
        - name: cafeId
          in: path
          required: true
          schema:
            type: string
            minLength: 3
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - posts
              properties:
                posts:
                  type: array
                  minItems: 1
                  maxItems: 200
                  items:
                    type: object
                    required:
                      - external_id
                      - title
                    properties:
                      external_id:
                        type: string
                      title:
                        type: string
                      body:
                        type: string
                      url:
                        type: string
                        format: uri
                      posted_at:
                        type: string
                        format: date-time
                      author_hash:
                        type: string
                      facility_id:
                        type: string
                      facility_name:
                        type: string
      responses:
        '200':
          description: ë“±ë¡ ê²°ê³¼
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OkDataResponse'

  # â”€â”€ Public Routes â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  /api/ujuz/referrals/track:
    post:
      operationId: trackReferral
      summary: ì¶”ì²œ ì´ë²¤íŠ¸ ì¶”ì 
      description: ì¶”ì²œ ì½”ë“œë¥¼ í†µí•œ ë°©ë¬¸/ê°€ì…/êµ¬ë… ì´ë²¤íŠ¸ë¥¼ ì¶”ì í•©ë‹ˆë‹¤.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - code
                - event_type
              properties:
                code:
                  type: string
                  minLength: 4
                  description: ì¶”ì²œ ì½”ë“œ
                event_type:
                  type: string
                  enum: [VISIT, SIGNUP, SUBSCRIBE]
                user_id:
                  type: string
                device_id:
                  type: string
                amount:
                  type: number
                currency:
                  type: string
                meta:
                  type: object
      responses:
        '200':
          description: ì¶”ì  ì„±ê³µ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OkDataResponse'

  /api/ujuz/widgets/{widgetKey}:
    get:
      operationId: getWidget
      summary: ìœ„ì ¯ ì„¤ì • ì¡°íšŒ
      description: ìœ„ì ¯ í‚¤ë¡œ ìœ„ì ¯ ì„¤ì •ì„ ì¡°íšŒí•©ë‹ˆë‹¤.
      parameters:
        - name: widgetKey
          in: path
          required: true
          schema:
            type: string
            minLength: 3
      responses:
        '200':
          description: ìœ„ì ¯ ì„¤ì •
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OkDataResponse'

  /health:
    get:
      operationId: healthCheck
      summary: í—¬ìŠ¤ì²´í¬
      description: ì„œë²„ ìƒíƒœ ë° MongoDB ì—°ê²° ìƒíƒœë¥¼ í™•ì¸í•©ë‹ˆë‹¤.
      responses:
        '200':
          description: ì •ìƒ
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  timestamp:
                    type: string
                    format: date-time
                  version:
                    type: string
                  uptime_seconds:
                    type: integer
                  node_env:
                    type: string
                  gitSha:
                    type: string
                  mongo:
                    type: object
                    properties:
                      ok:
                        type: boolean
                      latency_ms:
                        type: number
        '503':
          description: MongoDB ì—°ê²° ì‹¤íŒ¨
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                    example: false
                  mongo:
                    type: object
                    properties:
                      ok:
                        type: boolean
                        example: false

components:
  securitySchemes:
    deviceAuth:
      type: apiKey
      in: header
      name: x-device-id
      description: UUID v4 ë””ë°”ì´ìŠ¤ ì‹ë³„ì
    adminKeyAuth:
      type: apiKey
      in: header
      name: x-admin-key
      description: ê´€ë¦¬ì API í‚¤
    partnerKeyAuth:
      type: apiKey
      in: header
      name: x-partner-key
      description: íŒŒíŠ¸ë„ˆ API í‚¤

  schemas:
    OkDataResponse:
      type: object
      properties:
        ok:
          type: boolean
          example: true
        data:
          type: object

    PlaceSummary:
      type: object
      properties:
        placeId:
          type: string
        name:
          type: string
        address:
          type: string
        categories:
          type: array
          items:
            type: string
        region:
          type: string

    PlaceWithDistance:
      allOf:
        - $ref: '#/components/schemas/PlaceSummary'
        - type: object
          properties:
            distance_m:
              type: number
              description: ê±°ë¦¬ (ë¯¸í„°)

    PlaceDetail:
      allOf:
        - $ref: '#/components/schemas/PlaceSummary'
        - type: object
          properties:
            phone:
              type: string
            homepage:
              type: string
            capacity:
              type: integer
            classInfo:
              type: object
            operatingHours:
              type: string
            location:
              type: object
              properties:
                type:
                  type: string
                  example: Point
                coordinates:
                  type: array
                  items:
                    type: number

    AdmissionResult:
      type: object
      properties:
        score:
          type: number
        probability:
          type: number
        grade:
          type: string
        breakdown:
          type: object
        calculated_at:
          type: string
          format: date-time

    AdmissionScoreV1:
      type: object
      properties:
        probability:
          type: number
          description: 6ê°œì›” ë‚´ ì…ì†Œ í™•ë¥ 
          example: 0.62
        admission_score:
          type: integer
          description: ì…ì†Œ ì ìˆ˜ (0-100)
          example: 67
        confidence:
          type: number
          description: ì‹ ë¢°ë„
          example: 0.74
        estimated_months_median:
          type: integer
          description: ì˜ˆìƒ ëŒ€ê¸° ê°œì›” (ì¤‘ì•™ê°’)
        estimated_months_80th:
          type: integer
          description: ì˜ˆìƒ ëŒ€ê¸° ê°œì›” (80ë¶„ìœ„)
        evidence:
          type: array
          items:
            type: object
        engine_version:
          type: string
          example: v1.5.2
        calculated_at:
          type: string
          format: date-time

    Insight:
      type: object
      properties:
        placeId:
          type: string
        summary:
          type: string
        highlights:
          type: array
          items:
            type: string
        updated_at:
          type: string
          format: date-time

    TOSubscription:
      type: object
      properties:
        facility_id:
          type: string
        facility_name:
          type: string
        target_classes:
          type: array
          items:
            type: string
        created_at:
          type: string
          format: date-time

    TOAlert:
      type: object
      properties:
        facility_id:
          type: string
        facility_name:
          type: string
        alert_type:
          type: string
        message:
          type: string
        created_at:
          type: string
          format: date-time

    UserProfile:
      type: object
      properties:
        device_id:
          type: string
        display_name:
          type: string
        avatar_url:
          type: string
        children:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
              nickname:
                type: string
              birth_date:
                type: string
              age_class:
                type: string
                nullable: true
        created_at:
          type: string
          format: date-time

    ErrorResponse:
      type: object
      properties:
        error:
          type: object
          properties:
            code:
              type: string
            message:
              type: string

  responses:
    NotFound:
      description: ë¦¬ì†ŒìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error:
              code: not_found
              message: Resource not found

    ValidationError:
      description: ìœ íš¨ì„± ê²€ì¦ ì‹¤íŒ¨
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error:
              code: validation_error
              message: "facility_id: Required"

    Unauthorized:
      description: ì¸ì¦ ì‹¤íŒ¨
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error:
              code: invalid_device_id
              message: Missing or invalid x-device-id header